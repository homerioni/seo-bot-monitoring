import React from 'react';
import s from './ServerRecipient.module.scss';
import SwitchBtn from "../../../../../UI/StatusUI/SwitchBtn/SwitchBtn";
import {cutIp, getErrorMessage} from "../../../../../../utils/tools";
import {useQueryClient} from "react-query";
import {PMService} from "../../../../../../API/PMService";

const ServerRecipient = ({thread, data, setModalConfirm}) => {
    const queryClient = useQueryClient();

    const switchBtnHandle = () => {
        const textState = data.isActive ? 'Выключить' : 'Включить';
        setModalConfirm({
            isOpen: true,
            data: {
                title: `${textState} отправку на <b>${data.name}?</b>`,
                color: data.isActive ? 'red' : 'green',
                btnText: `Да, ${textState}`,
                iconType: 'server',
                onConfirm: (close) => {
                    PMService.settings.recipient.change(thread.id, data.recipientId, {
                        folderForRecording: data.folderForRecording,
                        isActive: !data.isActive,
                        serverId: data.id
                    }).then(() => {
                        queryClient.invalidateQueries([`threads${thread.server.id}`]);
                        close([{status: true, message: `Отправка на сервер ${data.name} успешно ${data.isActive ? 'выключена' : 'включена'}`}]);
                    }).catch(e => close(getErrorMessage(e)));
                },
            }
        })
    }

    return (
        <li className={`${s.main} ${data.isAlive ? s.active : s.disable}`}>
            <div className={s.header}>
                <div className={`${s.owner} ${data.affiliation ? (data.affiliation === 'rent' ? s.rent : s.our) : ''}`}>
                    {data.affiliation === 'rent' ?
                        <svg width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M4.77891 13.0687C4.76016 13.0687 4.73516 13.0812 4.71641 13.0812C3.50391 12.4812 2.51641 11.4874 1.91016 10.2749C1.91016 10.2562 1.92266 10.2312 1.92266 10.2124C2.68516 10.4374 3.47266 10.6062 4.25391 10.7374C4.39141 11.5249 4.55391 12.3062 4.77891 13.0687Z" fill="white"/>
                            <path d="M13.0859 10.2812C12.4672 11.5249 11.4359 12.5312 10.1797 13.1374C10.4172 12.3437 10.6172 11.5437 10.7484 10.7374C11.5359 10.6062 12.3109 10.4374 13.0734 10.2124C13.0672 10.2374 13.0859 10.2624 13.0859 10.2812Z" fill="white"/>
                            <path d="M13.1359 4.81904C12.3484 4.58154 11.5547 4.38779 10.7484 4.25029C10.6172 3.44404 10.4234 2.64404 10.1797 1.86279C11.4734 2.48154 12.5172 3.52529 13.1359 4.81904Z" fill="white"/>
                            <path d="M4.78203 1.93049C4.55703 2.69299 4.39453 3.46799 4.26328 4.25549C3.45703 4.38049 2.65703 4.58049 1.86328 4.81799C2.46953 3.56174 3.47578 2.53049 4.71953 1.91174C4.73828 1.91174 4.76328 1.93049 4.78203 1.93049Z" fill="white"/>
                            <path d="M9.68281 4.11826C8.23281 3.95576 6.77031 3.95576 5.32031 4.11826C5.47656 3.26201 5.67656 2.40576 5.95781 1.58076C5.97031 1.53076 5.96406 1.49326 5.97031 1.44326C6.46406 1.32451 6.97031 1.24951 7.50156 1.24951C8.02656 1.24951 8.53906 1.32451 9.02656 1.44326C9.03281 1.49326 9.03281 1.53076 9.04531 1.58076C9.32656 2.41201 9.52656 3.26201 9.68281 4.11826Z" fill="white"/>
                            <path d="M4.11973 9.68232C3.25723 9.52607 2.40723 9.32607 1.58223 9.04482C1.53223 9.03232 1.49473 9.03857 1.44473 9.03232C1.32598 8.53857 1.25098 8.03232 1.25098 7.50107C1.25098 6.97607 1.32598 6.46357 1.44473 5.97607C1.49473 5.96982 1.53223 5.96982 1.58223 5.95732C2.41348 5.68232 3.25723 5.47607 4.11973 5.31982C3.96348 6.76982 3.96348 8.23232 4.11973 9.68232Z" fill="white"/>
                            <path d="M13.7496 7.50107C13.7496 8.03232 13.6746 8.53857 13.5559 9.03232C13.5059 9.03857 13.4684 9.03232 13.4184 9.04482C12.5871 9.31982 11.7371 9.52607 10.8809 9.68232C11.0434 8.23232 11.0434 6.76982 10.8809 5.31982C11.7371 5.47607 12.5934 5.67607 13.4184 5.95732C13.4684 5.96982 13.5059 5.97607 13.5559 5.97607C13.6746 6.46982 13.7496 6.97607 13.7496 7.50107Z" fill="white"/>
                            <path d="M9.68281 10.8811C9.52656 11.7436 9.32656 12.5936 9.04531 13.4186C9.03281 13.4686 9.03281 13.5061 9.02656 13.5561C8.53906 13.6749 8.02656 13.7499 7.50156 13.7499C6.97031 13.7499 6.46406 13.6749 5.97031 13.5561C5.96406 13.5061 5.97031 13.4686 5.95781 13.4186C5.68281 12.5874 5.47656 11.7436 5.32031 10.8811C6.04531 10.9624 6.77031 11.0186 7.50156 11.0186C8.23281 11.0186 8.96406 10.9624 9.68281 10.8811Z" fill="white"/>
                            <path d="M9.85306 9.85159C8.28987 10.0488 6.71208 10.0488 5.14889 9.85159C4.95167 8.28841 4.95167 6.71061 5.14889 5.14743C6.71208 4.95021 8.28987 4.95021 9.85306 5.14743C10.0503 6.71061 10.0503 8.28841 9.85306 9.85159Z" fill="white"/>
                        </svg>
                        :
                        <svg width="11" height="10" viewBox="0 0 11 10" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M11 4.30283C11 3.68518 10.6975 3.11362 10.1842 2.77253L6.5175 0.311132C5.90333 -0.103711 5.09667 -0.103711 4.4825 0.311132L0.815833 2.77253C0.311667 3.11362 0 3.68518 0 4.30283V9.53906C0 9.79719 0.201667 10 0.458333 10H10.5417C10.7983 10 11 9.79719 11 9.53906V4.30283ZM5.5 7.69532C4.62 7.69532 3.89583 6.96704 3.89583 6.08205C3.89583 5.19705 4.62 4.46877 5.5 4.46877C6.38 4.46877 7.10417 5.19705 7.10417 6.08205C7.10417 6.96704 6.38 7.69532 5.5 7.69532Z" fill="white"/>
                        </svg>
                    }
                </div>
                <p className={s.name}>{data.name}</p>
                <p className={s.ip}>{cutIp(data.ip)}</p>
            </div>
            <p className={s.path}>
                <svg width="22" height="23" viewBox="0 0 22 23" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M19.304 11.585L19.1574 11.3833C18.9007 11.0716 18.5982 10.8241 18.2499 10.6408C17.7824 10.375 17.2507 10.2375 16.7007 10.2375H5.28821C4.73821 10.2375 4.21571 10.375 3.73904 10.6408C3.38154 10.8333 3.06071 11.0991 2.79487 11.4291C2.27237 12.0983 2.02487 12.9233 2.10737 13.7483L2.44654 18.0291C2.56571 19.3216 2.72154 20.9166 5.62738 20.9166H16.3707C19.2765 20.9166 19.4232 19.3216 19.5515 18.02L19.8907 13.7575C19.9732 12.9875 19.7715 12.2175 19.304 11.585Z" fill="#FFB74B"/>
                    <path d="M7.82489 15.5175C7.66744 15.6725 7.66542 15.9257 7.82038 16.0832L10.3456 18.649C10.5006 18.8064 10.7538 18.8084 10.9113 18.6535C11.0687 18.4985 11.0707 18.2452 10.9158 18.0878L8.67114 15.8071L10.9518 13.5625C11.1093 13.4075 11.1113 13.1542 10.9563 12.9968C10.8014 12.8393 10.5481 12.8373 10.3907 12.9923L7.82489 15.5175ZM13.8011 16.248C14.022 16.2497 14.2025 16.0721 14.2043 15.8512C14.2061 15.6303 14.0284 15.4498 13.8075 15.448L13.8011 16.248ZM8.10228 16.2026L13.8011 16.248L13.8075 15.448L8.10866 15.4026L8.10228 16.2026Z" fill="white"/>
                    <path d="M18.8395 8.55721C18.8806 8.93971 18.4645 9.19779 18.0978 9.08165C17.6556 8.94163 17.1917 8.87162 16.7102 8.87162H5.28849C4.80226 8.87162 4.32316 8.94658 3.87349 9.08983C3.51124 9.20522 3.09766 8.95668 3.09766 8.5765V6.85495C3.09766 3.58245 4.09682 2.58328 7.36932 2.58328H8.45099C9.76182 2.58328 10.1743 3.00495 10.706 3.69245L11.806 5.15912C12.0352 5.47078 12.0443 5.48912 12.4477 5.48912H14.6293C17.465 5.48912 18.5909 6.24087 18.8395 8.55721Z" fill="#FFB74B"/>
                </svg>
                <span>{data.folderForRecording}</span>
            </p>
            <div className={s.footer}>
                <p className={s.footerDesk}>{data.purpose}</p>
                <SwitchBtn active={data.isActive} onClick={switchBtnHandle}/>
            </div>
        </li>
    );
};

export default ServerRecipient;