import React, {useMemo} from 'react';
import s from './Servers.module.scss';
import Server from "./Server/Server";
import Loading from "../../UI/Loading/Loading";
import EmptyData from "../../UI/EmptyData/EmptyData";
import {getFilteredServers} from "../../../utils/tools";
import svgIcons from "../../Menu/svgIcons";

const Servers = ({searchData, servers, projectsData, setModalConfirm, setModalLoadLogs, setModalDist, setModalServer, serverIds, setModalDamage, filterData, locations}) => {
    const locationFiltered = useMemo(() => {
        const dataServers = getFilteredServers(servers.data?.result, serverIds, searchData, filterData, projectsData);
        const isHaveLocationServers = locations?.data?.result?.map(loc => {
            const servers = dataServers?.filter(serv => serv.location?.id === loc.id);
            return {id: loc?.id, name: loc.name, servers};
        });
        const dontHaveLocationServers = dataServers.filter(serv => !serv.location);
        return {
            servers: dataServers,
            haveLoc: isHaveLocationServers,
            dontHaveLoc: dontHaveLocationServers,
        }
    }, [servers.data, searchData, serverIds, filterData, locations?.data]);

    return (
        <div className={s.main}>
            {servers.isLoading ?
                <Loading/>
                :
                locationFiltered.servers.length ?
                    <>
                        {locationFiltered?.dontHaveLoc?.length ?
                            <div className={s.location}>
                                <div className={s.locationTitle}>
                                    <p className={s.locationName}>Без локации</p>
                                    <div className={s.locationQty}>
                                        <svg width="16" height="14" viewBox="0 0 16 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path fillRule="evenodd" clipRule="evenodd" d="M0.4688 0.455789C-4.76837e-08 0.911567 0 1.64423 0 3.11112C0 4.57801 -4.76837e-08 5.31068 0.4688 5.76646C0.9376 6.22223 1.6912 6.22223 3.2 6.22223H12.8C14.3088 6.22223 15.0624 6.22223 15.5312 5.76646C16 5.31068 16 4.57801 16 3.11112C16 1.64423 16 0.911567 15.5312 0.455789C15.0624 1.13977e-05 14.3088 1.14441e-05 12.8 1.14441e-05H3.2C1.6912 1.14441e-05 0.9376 1.13977e-05 0.4688 0.455789ZM5.6 4.47223C5.44087 4.47223 5.28826 4.41078 5.17574 4.30138C5.06321 4.19198 5 4.04361 5 3.8889V2.33334C5 2.17864 5.06321 2.03026 5.17574 1.92087C5.28826 1.81147 5.44087 1.75001 5.6 1.75001C5.75913 1.75001 5.91174 1.81147 6.02426 1.92087C6.13679 2.03026 6.2 2.17864 6.2 2.33334V3.8889C6.2 4.04361 6.13679 4.19198 6.02426 4.30138C5.91174 4.41078 5.75913 4.47223 5.6 4.47223ZM9.2 2.52779C9.04087 2.52779 8.88826 2.58925 8.77574 2.69864C8.66321 2.80804 8.6 2.95641 8.6 3.11112C8.6 3.26583 8.66321 3.41421 8.77574 3.5236C8.88826 3.633 9.04087 3.69446 9.2 3.69446H12.8C12.9591 3.69446 13.1117 3.633 13.2243 3.5236C13.3368 3.41421 13.4 3.26583 13.4 3.11112C13.4 2.95641 13.3368 2.80804 13.2243 2.69864C13.1117 2.58925 12.9591 2.52779 12.8 2.52779H9.2ZM3.2 4.47223C3.04087 4.47223 2.88826 4.41078 2.77574 4.30138C2.66321 4.19198 2.6 4.04361 2.6 3.8889V2.33334C2.6 2.17864 2.66321 2.03026 2.77574 1.92087C2.88826 1.81147 3.04087 1.75001 3.2 1.75001C3.35913 1.75001 3.51174 1.81147 3.62426 1.92087C3.73679 2.03026 3.8 2.17864 3.8 2.33334V3.8889C3.8 4.04361 3.73679 4.19198 3.62426 4.30138C3.51174 4.41078 3.35913 4.47223 3.2 4.47223ZM0.4688 8.23357C-4.76837e-08 8.68935 0 9.42201 0 10.8889C0 12.3558 -4.76837e-08 13.0885 0.4688 13.5442C0.9376 14 1.6912 14 3.2 14H12.8C14.3088 14 15.0624 14 15.5312 13.5442C16 13.0885 16 12.3558 16 10.8889C16 9.42201 16 8.68935 15.5312 8.23357C15.0624 7.77779 14.3088 7.77779 12.8 7.77779H3.2C1.6912 7.77779 0.9376 7.77779 0.4688 8.23357ZM8.6 10.8889C8.6 10.7342 8.66321 10.5858 8.77574 10.4764C8.88826 10.367 9.04087 10.3056 9.2 10.3056H12.8C12.9591 10.3056 13.1117 10.367 13.2243 10.4764C13.3368 10.5858 13.4 10.7342 13.4 10.8889C13.4 11.0436 13.3368 11.192 13.2243 11.3014C13.1117 11.4108 12.9591 11.4722 12.8 11.4722H9.2C9.04087 11.4722 8.88826 11.4108 8.77574 11.3014C8.66321 11.192 8.6 11.0436 8.6 10.8889ZM2.6 11.6667C2.6 11.8214 2.66321 11.9698 2.77574 12.0792C2.88826 12.1886 3.04087 12.25 3.2 12.25C3.35913 12.25 3.51174 12.1886 3.62426 12.0792C3.73679 11.9698 3.8 11.8214 3.8 11.6667V10.1111C3.8 9.95641 3.73679 9.80804 3.62426 9.69864C3.51174 9.58925 3.35913 9.52779 3.2 9.52779C3.04087 9.52779 2.88826 9.58925 2.77574 9.69864C2.66321 9.80804 2.6 9.95641 2.6 10.1111V11.6667ZM5.6 12.25C5.44087 12.25 5.28826 12.1886 5.17574 12.0792C5.06321 11.9698 5 11.8214 5 11.6667V10.1111C5 9.95641 5.06321 9.80804 5.17574 9.69864C5.28826 9.58925 5.44087 9.52779 5.6 9.52779C5.75913 9.52779 5.91174 9.58925 6.02426 9.69864C6.13679 9.80804 6.2 9.95641 6.2 10.1111V11.6667C6.2 11.8214 6.13679 11.9698 6.02426 12.0792C5.91174 12.1886 5.75913 12.25 5.6 12.25Z" fill="#A1B1C5"/>
                                        </svg>
                                        <span>{locationFiltered.dontHaveLoc.length}</span>
                                    </div>
                                </div>
                                {locationFiltered.dontHaveLoc.map(server => {
                                    return <Server key={server.id}
                                                   server={server}
                                                   projectsData={projectsData}
                                                   setModalConfirm={setModalConfirm}
                                                   setModalLoadLogs={setModalLoadLogs}
                                                   setModalDist={setModalDist}
                                                   setModalServer={setModalServer}
                                                   setModalDamage={setModalDamage}
                                                   locations={locations}/>
                                })}
                            </div> : ''}
                        {locationFiltered?.haveLoc?.length ?
                            locationFiltered.haveLoc.map(loc => (
                                loc.servers?.length ?
                                    <div key={loc.id} className={s.location}>
                                        <div className={s.locationTitle}>
                                            <p className={s.locationName}>
                                                {svgIcons.locations}
                                                <b> {loc.name}</b>
                                            </p>
                                            <div className={s.locationQty}>
                                                <svg width="16" height="14" viewBox="0 0 16 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                    <path fillRule="evenodd" clipRule="evenodd" d="M0.4688 0.455789C-4.76837e-08 0.911567 0 1.64423 0 3.11112C0 4.57801 -4.76837e-08 5.31068 0.4688 5.76646C0.9376 6.22223 1.6912 6.22223 3.2 6.22223H12.8C14.3088 6.22223 15.0624 6.22223 15.5312 5.76646C16 5.31068 16 4.57801 16 3.11112C16 1.64423 16 0.911567 15.5312 0.455789C15.0624 1.13977e-05 14.3088 1.14441e-05 12.8 1.14441e-05H3.2C1.6912 1.14441e-05 0.9376 1.13977e-05 0.4688 0.455789ZM5.6 4.47223C5.44087 4.47223 5.28826 4.41078 5.17574 4.30138C5.06321 4.19198 5 4.04361 5 3.8889V2.33334C5 2.17864 5.06321 2.03026 5.17574 1.92087C5.28826 1.81147 5.44087 1.75001 5.6 1.75001C5.75913 1.75001 5.91174 1.81147 6.02426 1.92087C6.13679 2.03026 6.2 2.17864 6.2 2.33334V3.8889C6.2 4.04361 6.13679 4.19198 6.02426 4.30138C5.91174 4.41078 5.75913 4.47223 5.6 4.47223ZM9.2 2.52779C9.04087 2.52779 8.88826 2.58925 8.77574 2.69864C8.66321 2.80804 8.6 2.95641 8.6 3.11112C8.6 3.26583 8.66321 3.41421 8.77574 3.5236C8.88826 3.633 9.04087 3.69446 9.2 3.69446H12.8C12.9591 3.69446 13.1117 3.633 13.2243 3.5236C13.3368 3.41421 13.4 3.26583 13.4 3.11112C13.4 2.95641 13.3368 2.80804 13.2243 2.69864C13.1117 2.58925 12.9591 2.52779 12.8 2.52779H9.2ZM3.2 4.47223C3.04087 4.47223 2.88826 4.41078 2.77574 4.30138C2.66321 4.19198 2.6 4.04361 2.6 3.8889V2.33334C2.6 2.17864 2.66321 2.03026 2.77574 1.92087C2.88826 1.81147 3.04087 1.75001 3.2 1.75001C3.35913 1.75001 3.51174 1.81147 3.62426 1.92087C3.73679 2.03026 3.8 2.17864 3.8 2.33334V3.8889C3.8 4.04361 3.73679 4.19198 3.62426 4.30138C3.51174 4.41078 3.35913 4.47223 3.2 4.47223ZM0.4688 8.23357C-4.76837e-08 8.68935 0 9.42201 0 10.8889C0 12.3558 -4.76837e-08 13.0885 0.4688 13.5442C0.9376 14 1.6912 14 3.2 14H12.8C14.3088 14 15.0624 14 15.5312 13.5442C16 13.0885 16 12.3558 16 10.8889C16 9.42201 16 8.68935 15.5312 8.23357C15.0624 7.77779 14.3088 7.77779 12.8 7.77779H3.2C1.6912 7.77779 0.9376 7.77779 0.4688 8.23357ZM8.6 10.8889C8.6 10.7342 8.66321 10.5858 8.77574 10.4764C8.88826 10.367 9.04087 10.3056 9.2 10.3056H12.8C12.9591 10.3056 13.1117 10.367 13.2243 10.4764C13.3368 10.5858 13.4 10.7342 13.4 10.8889C13.4 11.0436 13.3368 11.192 13.2243 11.3014C13.1117 11.4108 12.9591 11.4722 12.8 11.4722H9.2C9.04087 11.4722 8.88826 11.4108 8.77574 11.3014C8.66321 11.192 8.6 11.0436 8.6 10.8889ZM2.6 11.6667C2.6 11.8214 2.66321 11.9698 2.77574 12.0792C2.88826 12.1886 3.04087 12.25 3.2 12.25C3.35913 12.25 3.51174 12.1886 3.62426 12.0792C3.73679 11.9698 3.8 11.8214 3.8 11.6667V10.1111C3.8 9.95641 3.73679 9.80804 3.62426 9.69864C3.51174 9.58925 3.35913 9.52779 3.2 9.52779C3.04087 9.52779 2.88826 9.58925 2.77574 9.69864C2.66321 9.80804 2.6 9.95641 2.6 10.1111V11.6667ZM5.6 12.25C5.44087 12.25 5.28826 12.1886 5.17574 12.0792C5.06321 11.9698 5 11.8214 5 11.6667V10.1111C5 9.95641 5.06321 9.80804 5.17574 9.69864C5.28826 9.58925 5.44087 9.52779 5.6 9.52779C5.75913 9.52779 5.91174 9.58925 6.02426 9.69864C6.13679 9.80804 6.2 9.95641 6.2 10.1111V11.6667C6.2 11.8214 6.13679 11.9698 6.02426 12.0792C5.91174 12.1886 5.75913 12.25 5.6 12.25Z" fill="#A1B1C5"/>
                                                </svg>
                                                <span>{loc.servers.length}</span>
                                            </div>
                                        </div>
                                        {loc.servers.map(server =>
                                            <Server key={server.id}
                                                    server={server}
                                                    projectsData={projectsData}
                                                    setModalConfirm={setModalConfirm}
                                                    setModalLoadLogs={setModalLoadLogs}
                                                    setModalDist={setModalDist}
                                                    setModalServer={setModalServer}
                                                    setModalDamage={setModalDamage}
                                                    locations={locations}
                                            />
                                        )}
                                    </div> : ''
                            )) : ''}
                    </>
                    :
                    <EmptyData/>
            }
        </div>
    );
};

export default Servers;